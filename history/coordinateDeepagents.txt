åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ä»£ç†åè°ƒæ–¹æ¡ˆ

  ç°æœ‰å·¥å…·å®Œå…¨å¤Ÿç”¨ âœ…

  DeepAgents å·²ç»æä¾›äº†å®Œç¾çš„æ–‡ä»¶å…±äº«èƒ½åŠ›ï¼š

  # ç°æœ‰çš„6ä¸ªæ ¸å¿ƒæ–‡ä»¶å·¥å…·ï¼š
  ğŸ“ ls           # æŸ¥çœ‹å…±äº«ç›®å½•
  ğŸ“– read_file    # è¯»å–å…¶ä»–ä»£ç†çš„è¾“å‡º
  âœï¸ write_file   # å†™å…¥ç»“æœç»™ä¸‹ä¸€ä¸ªä»£ç†
  âœ‚ï¸ edit_file    # ä¿®æ”¹å…±äº«é…ç½®æ–‡ä»¶
  ğŸ” glob         # æŸ¥æ‰¾ç‰¹å®šç±»å‹çš„æ–‡ä»¶
  ğŸ” grep         # æœç´¢ç‰¹å®šä¿¡æ¯

  ğŸ—ï¸ ä¸‰ä»£ç†åè°ƒæ¶æ„è®¾è®¡

  ä»£ç†èŒè´£åˆ†å·¥

  # ä»£ç†1ï¼šé—®é¢˜æ£€æµ‹ä»£ç†
  issue_detector = create_deep_agent(
      tools=[static_analyzer, security_scanner, performance_tool],
      system_prompt="""ä½ æ˜¯é—®é¢˜æ£€æµ‹ä¸“å®¶ï¼Œè´Ÿè´£ï¼š
      1. æ‰«æä»£ç åº“å‘ç°é—®é¢˜
      2. å°†é—®é¢˜è¯¦æƒ…å†™å…¥ /workspace/issues/ ç›®å½•
      3. åˆ›å»ºæ£€æµ‹æŠ¥å‘Šä¾›ä¿®å¤ä»£ç†ä½¿ç”¨"""
  )

  # ä»£ç†2ï¼šä¿®å¤æ–¹æ¡ˆç”Ÿæˆä¸æ‰§è¡Œä»£ç†
  fix_generator = create_deep_agent(
      tools=[code_formatter, auto_fixer, patch_tool],
      system_prompt="""ä½ æ˜¯ä¿®å¤ä¸“å®¶ï¼Œè´Ÿè´£ï¼š
      1. è¯»å– /workspace/issues/ ç›®å½•ä¸­çš„é—®é¢˜æŠ¥å‘Š
      2. ç”Ÿæˆä¿®å¤æ–¹æ¡ˆå¹¶æ‰§è¡Œ
      3. å°†ä¿®å¤è®°å½•å†™å…¥ /workspace/fixes/ ç›®å½•"""
  )

  # ä»£ç†3ï¼šéªŒè¯ä»£ç†
  validator = create_deep_agent(
      tools=[test_runner, verification_tool, regression_tester],
      system_prompt="""ä½ æ˜¯éªŒè¯ä¸“å®¶ï¼Œè´Ÿè´£ï¼š
      1. è¯»å– /workspace/fixes/ ç›®å½•ä¸­çš„ä¿®å¤è®°å½•
      2. éªŒè¯ä¿®å¤æ˜¯å¦æˆåŠŸ
      3. å°†éªŒè¯ç»“æœå†™å…¥ /workspace/validation/ ç›®å½•"""
  )

  å…±äº«æ–‡ä»¶ç»“æ„è®¾è®¡

  /workspace/
  â”œâ”€â”€ issues/                    # ä»£ç†1çš„è¾“å‡ºç›®å½•
  â”‚   â”œâ”€â”€ security_issues.json
  â”‚   â”œâ”€â”€ performance_issues.json
  â”‚   â”œâ”€â”€ style_issues.json
  â”‚   â””â”€â”€ detection_summary.json
  â”œâ”€â”€ fixes/                     # ä»£ç†2çš„è¾“å‡ºç›®å½•
  â”‚   â”œâ”€â”€ applied_fixes.json
  â”‚   â”œâ”€â”€ fix_log.json
  â”‚   â””â”€â”€ modified_files/
  â”œâ”€â”€ validation/               # ä»£ç†3çš„è¾“å‡ºç›®å½•
  â”‚   â”œâ”€â”€ validation_results.json
  â”‚   â”œâ”€â”€ test_results.json
  â”‚   â””â”€â”€ final_report.json
  â”œâ”€â”€ config/                   # å…±äº«é…ç½®
  â”‚   â”œâ”€â”€ project_config.json
  â”‚   â””â”€â”€ coordination_state.json
  â””â”€â”€ shared/                   # å…±äº«èµ„æº
      â”œâ”€â”€ codebase/
      â””â”€â”€ temp/

  ğŸ› ï¸ å®ç°æ–¹æ¡ˆï¼ˆæ— éœ€é¢å¤–å·¥å…·ï¼‰

  æ–¹æ¡ˆ1ï¼šç®€å•çš„åè°ƒè„šæœ¬

  import json
  import time
  from pathlib import Path

  class ThreeAgentCoordinator:
      def __init__(self, workspace="/workspace"):
          self.workspace = Path(workspace)
          self.setup_workspace()

      def setup_workspace(self):
          """åˆ›å»ºå·¥ä½œç›®å½•ç»“æ„"""
          dirs = ["issues", "fixes", "validation", "config", "shared"]
          for dir_name in dirs:
              (self.workspace / dir_name).mkdir(parents=True, exist_ok=True)

      def coordinate_workflow(self, project_path):
          """åè°ƒä¸‰ä¸ªä»£ç†çš„å·¥ä½œæµç¨‹"""

          # é˜¶æ®µ1ï¼šé—®é¢˜æ£€æµ‹
          print("ğŸ” å¯åŠ¨é—®é¢˜æ£€æµ‹...")
          self.run_issue_detector(project_path)

          # é˜¶æ®µ2ï¼šä¿®å¤æ–¹æ¡ˆç”Ÿæˆä¸æ‰§è¡Œ
          print("ğŸ”§ å¯åŠ¨ä¿®å¤æ–¹æ¡ˆç”Ÿæˆ...")
          self.run_fix_generator()

          # é˜¶æ®µ3ï¼šéªŒè¯
          print("âœ… å¯åŠ¨éªŒè¯...")
          self.run_validator()

          # ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
          return self.generate_final_report()

      def run_issue_detector(self, project_path):
          """è¿è¡Œé—®é¢˜æ£€æµ‹ä»£ç†"""
          # åˆ›å»ºæ£€æµ‹ä»»åŠ¡é…ç½®
          config = {
              "project_path": project_path,
              "output_dir": str(self.workspace / "issues"),
              "timestamp": time.time()
          }

          # å†™å…¥é…ç½®æ–‡ä»¶
          (self.workspace / "config" / "detection_task.json").write_text(
              json.dumps(config, indent=2)
          )

          # å¯åŠ¨ä»£ç†1ï¼ˆè¿™é‡Œå‡è®¾å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼‰
          # issue_detector.invoke({
          #     "messages": [{
          #         "role": "user",
          #         "content": f"è¯·åˆ†æé¡¹ç›® {project_path} å¹¶å°†ç»“æœå†™å…¥ {self.workspace / 'issues'}"
          #     }]
          # })

          print("âœ… é—®é¢˜æ£€æµ‹å®Œæˆï¼Œç»“æœå·²ä¿å­˜åˆ° issues/ ç›®å½•")

      def run_fix_generator(self):
          """è¿è¡Œä¿®å¤ä»£ç†"""
          # æ£€æŸ¥æ˜¯å¦æœ‰é—®é¢˜éœ€è¦ä¿®å¤
          issues_dir = self.workspace / "issues"
          if not any(issues_dir.iterdir()):
              print("âœ… æœªå‘ç°é—®é¢˜ï¼Œè·³è¿‡ä¿®å¤é˜¶æ®µ")
              return

          # ä»£ç†2è¯»å–é—®é¢˜å¹¶ä¿®å¤
          # fix_generator.invoke({
          #     "messages": [{
          #         "role": "user",
          #         "content": f"è¯·è¯»å– {issues_dir} ä¸­çš„é—®é¢˜æŠ¥å‘Šå¹¶ç”Ÿæˆä¿®å¤æ–¹æ¡ˆ"
          #     }]
          # })

          print("âœ… ä¿®å¤æ–¹æ¡ˆæ‰§è¡Œå®Œæˆï¼Œç»“æœå·²ä¿å­˜åˆ° fixes/ ç›®å½•")

      def run_validator(self):
          """è¿è¡ŒéªŒè¯ä»£ç†"""
          # ä»£ç†3éªŒè¯ä¿®å¤ç»“æœ
          # validator.invoke({
          #     "messages": [{
          #         "role": "user",
          #         "content": f"è¯·éªŒè¯ {self.workspace / 'fixes'} ä¸­çš„ä¿®å¤æ˜¯å¦æˆåŠŸ"
          #     }]
          # })

          print("âœ… éªŒè¯å®Œæˆï¼Œç»“æœå·²ä¿å­˜åˆ° validation/ ç›®å½•")

      def generate_final_report(self):
          """ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š"""
          report = {
              "workflow_summary": {
                  "timestamp": time.time(),
                  "workspace": str(self.workspace)
              },
              "detection_results": self.load_json_files("issues"),
              "fix_results": self.load_json_files("fixes"),
              "validation_results": self.load_json_files("validation")
          }

          report_path = self.workspace / "final_report.json"
          report_path.write_text(json.dumps(report, indent=2))

          return report_path

      def load_json_files(self, directory):
          """åŠ è½½ç›®å½•ä¸­çš„æ‰€æœ‰JSONæ–‡ä»¶"""
          result = {}
          for file_path in (self.workspace / directory).glob("*.json"):
              result[file_path.name] = json.loads(file_path.read_text())
          return result

  # ä½¿ç”¨ç¤ºä¾‹
  coordinator = ThreeAgentCoordinator("/workspace/code_quality")
  final_report = coordinator.coordinate_workflow("/path/to/project")

  æ–¹æ¡ˆ2ï¼šå¢å¼ºå‹åè°ƒå·¥å…·ï¼ˆå¯é€‰ï¼‰

  å¦‚æœéœ€è¦æ›´å¼ºå¤§çš„åè°ƒèƒ½åŠ›ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„åè°ƒå·¥å…·ï¼š

  from langchain_core.tools import tool

  @tool
  def coordinate_agents(stage: str, input_data: str) -> str:
      """
      åè°ƒä¸‰ä¸ªä»£ç†çš„å·¥ä½œæµç¨‹

      Args:
          stage: å·¥ä½œé˜¶æ®µ (detection/fix/validation)
          input_data: è¾“å…¥æ•°æ®æˆ–é…ç½®

      Returns:
          åè°ƒç»“æœå’Œä¸‹ä¸€æ­¥æŒ‡ä»¤
      """
      workspace = Path("/workspace")

      if stage == "detection":
          # æ£€æŸ¥å‰ç½®æ¡ä»¶
          config = {
              "stage": "detection",
              "input": input_data,
              "output_dir": str(workspace / "issues"),
              "status": "ready"
          }
          (workspace / "config" / "workflow_state.json").write_text(
              json.dumps(config, indent=2)
          )
          return "é—®é¢˜æ£€æµ‹é˜¶æ®µå·²å‡†å¤‡å°±ç»ªï¼Œè¯·å¼€å§‹æ£€æµ‹å¹¶ä¿å­˜åˆ° issues/ ç›®å½•"

      elif stage == "fix":
          # æ£€æŸ¥é—®é¢˜æ£€æµ‹ç»“æœ
          issues_dir = workspace / "issues"
          if not any(issues_dir.iterdir()):
              return "æœªå‘ç°é—®é¢˜ï¼Œè·³è¿‡ä¿®å¤é˜¶æ®µ"

          config = {
              "stage": "fix",
              "input_dir": str(issues_dir),
              "output_dir": str(workspace / "fixes"),
              "status": "ready"
          }
          (workspace / "config" / "workflow_state.json").write_text(
              json.dumps(config, indent=2)
          )
          return "ä¿®å¤é˜¶æ®µå·²å‡†å¤‡å°±ç»ªï¼Œè¯·è¯»å– issues/ ç›®å½•å¹¶ç”Ÿæˆä¿®å¤æ–¹æ¡ˆ"

      elif stage == "validation":
          # æ£€æŸ¥ä¿®å¤ç»“æœ
          fixes_dir = workspace / "fixes"
          if not any(fixes_dir.iterdir()):
              return "æ²¡æœ‰ä¿®å¤éœ€è¦éªŒè¯"

          config = {
              "stage": "validation",
              "input_dir": str(fixes_dir),
              "output_dir": str(workspace / "validation"),
              "status": "ready"
          }
          (workspace / "config" / "workflow_state.json").write_text(
              json.dumps(config, indent=2)
          )
          return "éªŒè¯é˜¶æ®µå·²å‡†å¤‡å°±ç»ªï¼Œè¯·éªŒè¯ fixes/ ç›®å½•ä¸­çš„ä¿®å¤ç»“æœ"

      return "æœªçŸ¥é˜¶æ®µï¼Œè¯·æŒ‡å®š detection/fix/validation"

  # åˆ›å»ºå¸¦æœ‰åè°ƒå·¥å…·çš„ä¸»ä»£ç†
  master_agent = create_deep_agent(
      tools=[coordinate_agents, ls, read_file, write_file],
      system_prompt="""ä½ æ˜¯ä¸»åè°ƒä»£ç†ï¼Œè´Ÿè´£ï¼š
      1. ä½¿ç”¨ coordinate_agents å·¥å…·åè°ƒä¸‰ä¸ªä»£ç†çš„å·¥ä½œ
      2. ç›‘æ§æ•´ä¸ªå·¥ä½œæµç¨‹
      3. å¤„ç†å¼‚å¸¸å’Œé‡è¯•
      4. ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š"""
  )

  ğŸ“‹ ä»£ç†é—´çš„æ ‡å‡†æ•°æ®æ ¼å¼

  é—®é¢˜æŠ¥å‘Šæ ¼å¼

  {
    "detection_report": {
      "timestamp": "2024-01-01T10:00:00Z",
      "project_path": "/path/to/project",
      "issues": [
        {
          "id": "SEC001",
          "type": "security",
          "severity": "high",
          "file": "src/auth.py",
          "line": 45,
          "description": "SQLæ³¨å…¥æ¼æ´",
          "recommendation": "ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢"
        }
      ]
    }
  }

  ä¿®å¤æŠ¥å‘Šæ ¼å¼

  {
    "fix_report": {
      "timestamp": "2024-01-01T10:05:00Z",
      "applied_fixes": [
        {
          "issue_id": "SEC001",
          "fix_type": "code_rewrite",
          "file": "src/auth.py",
          "backup_created": "src/auth.py.backup",
          "status": "applied"
        }
      ]
    }
  }

  éªŒè¯æŠ¥å‘Šæ ¼å¼

  {
    "validation_report": {
      "timestamp": "2024-01-01T10:10:00Z",
      "results": [
        {
          "issue_id": "SEC001",
          "validation_status": "passed",
          "test_results": "all_tests_passed",
          "regression_detected": false
        }
      ],
      "overall_status": "success"
    }
  }

  ğŸš€ å®é™…ä½¿ç”¨æµç¨‹

  # 1. å¯åŠ¨åè°ƒç³»ç»Ÿ
  python coordinator.py --project /path/to/code

  # 2. æˆ–è€…æ‰‹åŠ¨åè°ƒæ¯ä¸ªä»£ç†
  python run_agent.py issue_detector --input /path/to/code --output /workspace/issues
  python run_agent.py fix_generator --input /workspace/issues --output /workspace/fixes
  python run_agent.py validator --input /workspace/fixes --output /workspace/validation

  # 3. æŸ¥çœ‹æœ€ç»ˆæŠ¥å‘Š
  cat /workspace/final_report.json

  âœ… æ€»ç»“

  ä½ ä¸éœ€è¦ç¼–å†™å¤æ‚çš„å·¥å…·ï¼ DeepAgents çš„ç°æœ‰æ–‡ä»¶ç³»ç»Ÿå·¥å…·å·²ç»å®Œå…¨è¶³å¤Ÿï¼š

  1. write_file - æ¯ä¸ªä»£ç†å†™å…¥ç»“æœ
  2. read_file - ä¸‹ä¸€ä¸ªä»£ç†è¯»å–å‰ä¸€ä¸ªçš„ç»“æœ
  3. ls å’Œ glob - æŸ¥çœ‹å¯ç”¨çš„è¾“å…¥æ–‡ä»¶
  4. grep - æœç´¢ç‰¹å®šä¿¡æ¯
  5. ç®€å•çš„åè°ƒè„šæœ¬ - ç®¡ç†æ•´ä¸ªå·¥ä½œæµç¨‹

  è¿™ç§åŸºäºæ–‡ä»¶çš„åè°ƒæ–¹å¼ï¼š
  - âœ… ç®€å•å¯é  - ä¸éœ€è¦å¤æ‚çš„ç½‘ç»œé€šä¿¡
  - âœ… æ˜“äºè°ƒè¯• - å¯ä»¥ç›´æ¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹
  - âœ… å®¹é”™æ€§å¼º - æ–‡ä»¶ç³»ç»Ÿå¤©ç„¶æ”¯æŒé”™è¯¯æ¢å¤
  - âœ… æ‰©å±•æ€§å¥½ - å®¹æ˜“æ·»åŠ æ–°çš„ä»£ç†æˆ–ä¿®æ”¹æµç¨‹

  åªéœ€è¦è®¾è®¡å¥½æ–‡ä»¶ç»“æ„å’Œæ•°æ®æ ¼å¼ï¼Œä¸‰ä¸ªç‹¬ç«‹çš„ DeepAgents å°±èƒ½å®Œç¾åè°ƒå·¥ä½œï¼