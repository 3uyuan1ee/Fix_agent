# Fix Agent æµ‹è¯•å¥—ä»¶

è¿™æ˜¯ Fix Agent é¡¹ç›®çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…å«å¯¹æ‰€æœ‰æ ¸å¿ƒæ¨¡å—çš„è¯¦ç»†æµ‹è¯•ã€‚

## ğŸ“‹ æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ conftest.py              # pytesté…ç½®å’Œå¤¹å…·
â”œâ”€â”€ README.md                # æµ‹è¯•æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ test_agents.py           # AIä»£ç†ç³»ç»Ÿæµ‹è¯•
â”œâ”€â”€ test_tools.py            # å·¥å…·ç³»ç»Ÿæµ‹è¯•
â”œâ”€â”€ test_middleware.py       # ä¸­é—´ä»¶ç³»ç»Ÿæµ‹è¯•
â””â”€â”€ test_interface.py        # æ¥å£å±‚æµ‹è¯•
```

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. AIä»£ç†ç³»ç»Ÿ (test_agents.py)
- **ä»£ç†åˆ›å»ºå’Œé…ç½®**
  - é»˜è®¤é…ç½®åˆ›å»º
  - è‡ªå®šä¹‰å·¥å…·é…ç½®
  - ä¸åŒè®°å¿†æ¨¡å¼
  - æ— æ•ˆå‚æ•°å¤„ç†

- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**
  - ä»£ç†åˆå§‹åŒ–
  - çŠ¶æ€æŒä¹…åŒ–
  - é‡ç½®åŠŸèƒ½

- **å·¥å…·é›†æˆ**
  - ä»£ç åˆ†æå·¥å…·
  - ç½‘ç»œå·¥å…·
  - æ–‡ä»¶æ“ä½œå·¥å…·

- **ä¸­é—´ä»¶é›†æˆ**
  - è®°å¿†ä¸­é—´ä»¶
  - æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
  - å®‰å…¨ä¸­é—´ä»¶

- **æ€§èƒ½æµ‹è¯•**
  - åˆ›å»ºæ€§èƒ½
  - å¤šä»£ç†åˆ›å»ºæ€§èƒ½

### 2. å·¥å…·ç³»ç»Ÿ (test_tools.py)
- **ä»£ç åˆ†æå·¥å…·**
  - Pythonä»£ç ç¼ºé™·åˆ†æ
  - JavaScriptä»£ç åˆ†æ
  - è‡ªåŠ¨è¯­è¨€æ£€æµ‹
  - å¤æ‚åº¦åˆ†æ

- **ç¼–è¯‘å·¥å…·**
  - Pythoné¡¹ç›®ç¼–è¯‘
  - JavaScripté¡¹ç›®ç¼–è¯‘

- **ç›‘æ§å·¥å…·**
  - ç¨‹åºè¿è¡Œç›‘æ§
  - æµ‹è¯•æ‰§è¡Œå’Œé”™è¯¯æ•è·

- **é¡¹ç›®æ¢ç´¢**
  - Pythoné¡¹ç›®ç»“æ„æ¢ç´¢
  - ç©ºé¡¹ç›®å¤„ç†
  - ä¸å­˜åœ¨é¡¹ç›®å¤„ç†

- **ä»£ç æ ¼å¼åŒ–**
  - Pythonä»£ç æ ¼å¼åŒ–
  - JavaScriptä»£ç æ ¼å¼åŒ–
  - æ‰¹é‡æ ¼å¼åŒ–

- **æµ‹è¯•ç”Ÿæˆ**
  - Pythonæµ‹è¯•ç”Ÿæˆ
  - JavaScriptæµ‹è¯•ç”Ÿæˆ
  - æµ‹è¯•å¥—ä»¶æ‰§è¡Œ

- **ç½‘ç»œå·¥å…·**
  - ç½‘ç»œæœç´¢
  - HTTPè¯·æ±‚

- **é”™è¯¯å¤„ç†**
  - æ— æ•ˆæ–‡ä»¶è·¯å¾„
  - æŸåæ–‡ä»¶

- **æ€§èƒ½æµ‹è¯•**
  - å¤§æ–‡ä»¶åˆ†æ
  - å¹¶å‘æ‰§è¡Œ

### 3. ä¸­é—´ä»¶ç³»ç»Ÿ (test_middleware.py)
- **åˆ†å±‚è®°å¿†ä¸­é—´ä»¶**
  - å·¥ä½œè®°å¿†æ“ä½œ
  - ä¼šè¯è®°å¿†æ“ä½œ
  - é•¿æœŸè®°å¿†æ“ä½œ
  - è‡ªåŠ¨å‡çº§åŠŸèƒ½

- **æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶**
  - CPUç›‘æ§
  - å†…å­˜è·Ÿè¸ª
  - æ€§èƒ½æŒ‡æ ‡æ”¶é›†

- **å®‰å…¨ä¸­é—´ä»¶**
  - è·¯å¾„éªŒè¯
  - å‘½ä»¤éªŒè¯
  - æ–‡ä»¶å¤§å°éªŒè¯

- **æ—¥å¿—ä¸­é—´ä»¶**
  - ç»“æ„åŒ–æ—¥å¿—è®°å½•
  - æ—¥å¿—è½®è½¬
  - æ§åˆ¶å°æ—¥å¿—

- **ä¸Šä¸‹æ–‡å¢å¼ºä¸­é—´ä»¶**
  - ä¸Šä¸‹æ–‡æ„å»º
  - ä¸Šä¸‹æ–‡å¢å¼º

- **ä¸­é—´ä»¶ç®¡é“**
  - ä¸­é—´ä»¶é“¾åˆ›å»º
  - æ‰§è¡Œé¡ºåºéªŒè¯
  - é”™è¯¯å¤„ç†

### 4. æ¥å£å±‚ (test_interface.py)
- **ä»»åŠ¡æ‰§è¡Œ**
  - å·¥å…·å‚æ•°æå–
  - æ‘˜è¦æ¶ˆæ¯æ£€æµ‹
  - å·¥å…·å®¡æ‰¹
  - Tokenè·Ÿè¸ª

- **å‘½ä»¤å¤„ç†**
  - å¸®åŠ©å‘½ä»¤
  - è®°å¿†å‘½ä»¤
  - åˆ†æå‘½ä»¤
  - ä¿®å¤å‘½ä»¤

- **è®°å¿†ç®¡ç†å‘½ä»¤**
  - è®°å¿†æ–‡ä»¶åˆ›å»º
  - è®°å¿†æœç´¢
  - è®°å¿†ç¼–è¾‘
  - è®°å¿†ç»Ÿè®¡å’Œå¯¼å‡º

- **UIç»„ä»¶**
  - Tokenè·Ÿè¸ªå™¨
  - å·¥å…·æ˜¾ç¤ºæ ¼å¼åŒ–
  - å·®å¼‚æ¸²æŸ“
  - æ‘˜è¦é¢æ¿æ¸²æŸ“

- **é”™è¯¯å¤„ç†**
  - ç•¸å½¢è¾“å…¥
  - Agentå¤±è´¥
  - æ–‡ä»¶æ“ä½œé”™è¯¯

- **ä¸­æ–­å¤„ç†**
  - é”®ç›˜ä¸­æ–­
  - ä»»åŠ¡è¶…æ—¶

## ğŸš€ è¿è¡Œæµ‹è¯•

### å®‰è£…ä¾èµ–
```bash
pip install pytest pytest-mock pytest-asyncio
```

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
pytest tests/ -v
```

### è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
```bash
# è¿è¡Œä»£ç†ç³»ç»Ÿæµ‹è¯•
pytest tests/test_agents.py -v

# è¿è¡Œå·¥å…·ç³»ç»Ÿæµ‹è¯•
pytest tests/test_tools.py -v

# è¿è¡Œä¸­é—´ä»¶æµ‹è¯•
pytest tests/test_middleware.py -v

# è¿è¡Œæ¥å£å±‚æµ‹è¯•
pytest tests/test_interface.py -v
```

### ä½¿ç”¨æµ‹è¯•æ ‡è®°
```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/ -m "unit" -v

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/ -m "integration" -v

# æ’é™¤æ…¢é€Ÿæµ‹è¯•
pytest tests/ -m "not slow" -v

# è¿è¡Œéœ€è¦ç½‘ç»œçš„æµ‹è¯•
pytest tests/ -m "requires_network" -v
```

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```bash
pytest tests/ --cov=src --cov-report=html --cov-report=term
```

### å¹¶è¡Œè¿è¡Œæµ‹è¯•
```bash
pytest tests/ -n auto  # éœ€è¦å®‰è£… pytest-xdist
```

## ğŸ”§ æµ‹è¯•é…ç½®

### ç¯å¢ƒå˜é‡
```bash
export TESTING=true
export FIX_AGENT_TEST_MODE=true
```

### æµ‹è¯•å¤¹å…·
- `temp_dir`: åˆ›å»ºä¸´æ—¶ç›®å½•
- `temp_file`: åˆ›å»ºä¸´æ—¶æ–‡ä»¶
- `sample_python_file`: Pythonç¤ºä¾‹ä»£ç 
- `sample_javascript_file`: JavaScriptç¤ºä¾‹ä»£ç 
- `sample_project_structure`: ç¤ºä¾‹é¡¹ç›®ç»“æ„
- `mock_memory_files`: æ¨¡æ‹Ÿè®°å¿†æ–‡ä»¶
- `mock_agent_responses`: æ¨¡æ‹ŸAgentå“åº”
- `error_prone_code`: åŒ…å«é”™è¯¯çš„ä»£ç ç¤ºä¾‹

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

### é¢„æœŸæµ‹è¯•æ•°é‡
- **test_agents.py**: ~30ä¸ªæµ‹è¯•ç”¨ä¾‹
- **test_tools.py**: ~50ä¸ªæµ‹è¯•ç”¨ä¾‹
- **test_middleware.py**: ~40ä¸ªæµ‹è¯•ç”¨ä¾‹
- **test_interface.py**: ~45ä¸ªæµ‹è¯•ç”¨ä¾‹
- **æ€»è®¡**: ~165ä¸ªæµ‹è¯•ç”¨ä¾‹

### è¦†ç›–ç›®æ ‡
- **ä»£ç è¦†ç›–ç‡**: ç›®æ ‡ â‰¥80%
- **åˆ†æ”¯è¦†ç›–ç‡**: ç›®æ ‡ â‰¥75%
- **åŠŸèƒ½è¦†ç›–ç‡**: ç›®æ ‡ â‰¥90%

## ğŸ› è°ƒè¯•æµ‹è¯•

### è¿è¡Œå•ä¸ªæµ‹è¯•
```bash
pytest tests/test_agents.py::TestAgentCreation::test_create_agent_with_default_config -v -s
```

### æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
```bash
pytest tests/ -v -s --tb=long
```

### åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
```bash
pytest tests/ --lf
```

### è°ƒè¯•æ¨¡å¼
```bash
pytest tests/ --pdb
```

## ğŸ“ æµ‹è¯•ç¼–å†™æŒ‡å—

### æµ‹è¯•å‘½åè§„èŒƒ
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- é‡‡ç”¨ `test_åŠŸèƒ½_åœºæ™¯` çš„å‘½åæ ¼å¼
- éµå¾ª PEP 8 å‘½åè§„èŒƒ

### æµ‹è¯•ç»“æ„
```python
def test_specific_functionality():
    """æµ‹è¯•ç‰¹å®šåŠŸèƒ½çš„æè¿°"""
    # Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®
    # Act - æ‰§è¡Œæµ‹è¯•æ“ä½œ
    # Assert - éªŒè¯æµ‹è¯•ç»“æœ
```

### Mockä½¿ç”¨
```python
from unittest.mock import Mock, patch

@patch('module.function')
def test_with_mock(mock_function):
    mock_function.return_value = "mocked_value"
    result = function_being_tested()
    assert result == "expected_result"
```

### å¼‚æ­¥æµ‹è¯•
```python
@pytest.mark.asyncio
async def test_async_function():
    result = await async_function()
    assert result is not None
```

## ğŸ” æŒç»­é›†æˆ

### GitHub Actionsé…ç½®ç¤ºä¾‹
```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.8
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest pytest-mock pytest-asyncio
    - name: Run tests
      run: pytest tests/ --cov=src --cov-report=xml
```

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆä»¥ä¸‹æŠ¥å‘Šï¼š
- æ§åˆ¶å°è¾“å‡ºï¼šå®æ—¶æµ‹è¯•ç»“æœ
- HTMLè¦†ç›–ç‡æŠ¥å‘Šï¼šè¯¦ç»†çš„ä»£ç è¦†ç›–ç‡
- XMLæŠ¥å‘Šï¼šCI/CDé›†æˆä½¿ç”¨

## ğŸš¨ å·²çŸ¥é™åˆ¶

1. **ç½‘ç»œä¾èµ–**: æŸäº›æµ‹è¯•éœ€è¦ç½‘ç»œè®¿é—®ï¼Œä½¿ç”¨ `requires_network` æ ‡è®°
2. **å¤–éƒ¨API**: æµ‹è¯•ä¸­ä½¿ç”¨Mocké¿å…å®é™…APIè°ƒç”¨
3. **æ€§èƒ½æµ‹è¯•**: åœ¨CIç¯å¢ƒä¸­å¯èƒ½éœ€è¦è°ƒæ•´è¶…æ—¶æ—¶é—´
4. **èµ„æºé™åˆ¶**: å¤§æ–‡ä»¶æµ‹è¯•å¯èƒ½éœ€è¦æ›´å¤šå†…å­˜å’Œæ—¶é—´

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•
1. ç¡®å®šæµ‹è¯•ç±»å‹å’Œä½ç½®
2. ä½¿ç”¨ç°æœ‰çš„æµ‹è¯•å¤¹å…·
3. éµå¾ªå‘½åå’Œç»“æ„è§„èŒƒ
4. æ·»åŠ é€‚å½“çš„æ–‡æ¡£å­—ç¬¦ä¸²
5. æ›´æ–°READMEæ–‡æ¡£

### æµ‹è¯•ç»´æŠ¤
- å®šæœŸæ›´æ–°Mockå¯¹è±¡
- æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡å˜åŒ–
- æ›´æ–°è¿‡æ—¶çš„æµ‹è¯•ç”¨ä¾‹
- ä¼˜åŒ–æ…¢é€Ÿæµ‹è¯•

## ğŸ“š å‚è€ƒèµ„æ–™

- [pytestå®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)
- [pytest-mockæ–‡æ¡£](https://pytest-mock.readthedocs.io/)
- [æµ‹è¯•è¦†ç›–ç‡å·¥å…·coverage.py](https://coverage.readthedocs.io/)
- [Pythonæµ‹è¯•æœ€ä½³å®è·µ](https://docs.python-guide.org/writing/tests/)

---

*æœ€åæ›´æ–°: 2025å¹´1æœˆ*