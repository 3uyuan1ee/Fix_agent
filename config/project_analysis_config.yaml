# 项目分析工作流配置文件
# Project Analysis Workflow Configuration

# 基本配置
basic:
  # 分析模式
  analysis_mode: "comprehensive"  # quick, standard, comprehensive
  # 并发设置
  max_concurrent_files: 5
  max_concurrent_analyses: 3
  # 超时设置
  file_analysis_timeout: 300  # 秒
  total_analysis_timeout: 3600  # 秒

# 工作流配置 - 严格按照工作流图设计
workflow:
  # 工作流控制
  enable_workflow_management: true
  strict_workflow_enforcement: true  # 严格遵循工作流图
  auto_transition: false  # 不自动转换，需要用户确认

  # 工作流节点配置
  nodes:
    phase_a_complete:
      name: "Phase 1-4 完成"
      description: "静态分析与AI分析结合用户决策进行文件选择"
      required_inputs: ["project_info", "static_analysis_result", "ai_file_selection", "user_decision"]
      outputs: ["selected_files_for_phase5"]

    problem_detection:
      name: "AI问题检测"
      description: "AI基于静态分析结果深度发现问题"
      ai_provider: "zhipu"
      model: "glm-4.5-air"
      temperature: 0.3
      max_tokens: 4000
      timeout: 60
      context_priority: "balanced"

    fix_suggestion:
      name: "AI修复建议生成"
      description: "AI为检测到的问题生成具体修复建议"
      ai_provider: "zhipu"
      model: "glm-4.5-air"
      temperature: 0.3
      max_tokens: 6000
      timeout: 90
      include_alternatives: true
      max_alternatives: 3

    user_review:
      name: "用户审查"
      description: "用户审查AI修复建议"
      require_user_input: true
      timeout: 300
      decision_options: ["approve", "modify", "reject"]

    user_decision:
      name: "用户决策"
      description: "用户对修复建议做出最终决策"
      require_user_input: true
      timeout: 180
      allow_modifications: true

    auto_fix:
      name: "自动修复执行"
      description: "执行AI提供的修复代码替换"
      backup_required: true
      syntax_validation: true
      max_fixes_per_batch: 5
      timeout: 30

    skip_problem:
      name: "跳过问题"
      description: "跳过当前问题，继续处理下一个"
      record_skip_reason: true

    fix_verification:
      name: "修复验证"
      description: "验证修复效果，包括静态分析和AI动态分析"
      static_analysis_required: true
      ai_analysis_required: true
      verification_timeout: 60

    verification_decision:
      name: "验证决策"
      description: "用户查看验证结果进行选择"
      require_user_input: true
      timeout: 120
      decision_options: ["success", "failed"]

    problem_solved:
      name: "问题解决"
      description: "问题已成功解决"
      update_statistics: true

    reanalysis:
      name: "重新分析"
      description: "修复失败后重新分析问题"
      max_retry_attempts: 3
      retry_delay: 5

    check_remaining:
      name: "检查剩余问题"
      description: "检查是否还有待处理问题"
      auto_continue: false

    workflow_complete:
      name: "工作流完成"
      description: "所有工作完成，生成最终报告"
      generate_summary: true
      cleanup_temp_files: true

  # 状态转换规则
  transitions:
    # 允许的转换路径（严格按照工作流图）
    phase_a_complete: ["problem_detection"]
    problem_detection: ["fix_suggestion"]
    fix_suggestion: ["user_review"]
    user_review: ["user_decision"]
    user_decision: ["auto_fix", "fix_suggestion", "skip_problem"]
    auto_fix: ["fix_verification"]
    skip_problem: ["check_remaining"]
    fix_verification: ["verification_decision"]
    verification_decision: ["problem_solved", "reanalysis"]
    problem_solved: ["check_remaining"]
    reanalysis: ["problem_detection"]
    check_remaining: ["problem_detection", "workflow_complete"]
    workflow_complete: []

  # 循环控制
  loops:
    reanalysis_loop:
      enabled: true
      max_iterations: 3
      failure_threshold: 2
    remaining_check_loop:
      enabled: true
      continue_on_remaining: true

# 修复执行配置
fix_execution:
  # 安全设置
  backup_enabled: true
  backup_directory: ".fix_backups"
  backup_retention_days: 7

  # 修改限制
  max_file_size_mb: 10
  max_lines_per_fix: 50
  allowed_file_types: [".py", ".js", ".ts", ".jsx", ".tsx", ".java", ".cpp", ".c", ".h", ".hpp"]

  # 执行控制
  dry_run_mode: false  # 模拟执行模式
  require_confirmation: true
  batch_execution: false
  parallel_execution: false

# 文件选择配置
file_selection:
  # 最大文件数量
  max_files_to_analyze: 50
  # Token限制
  max_tokens_per_file: 4000
  max_total_tokens: 50000
  # 文件大小限制（字节）
  max_file_size: 1048576  # 1MB
  # 文件类型过滤
  include_patterns:
    - "*.py"
    - "*.js"
    - "*.ts"
    - "*.jsx"
    - "*.tsx"
    - "*.java"
    - "*.cpp"
    - "*.c"
    - "*.h"
    - "*.hpp"
  exclude_patterns:
    - "*/__pycache__/*"
    - "*/node_modules/*"
    - "*/venv/*"
    - "*/.git/*"
    - "*/build/*"
    - "*/dist/*"
    - "*.min.js"
    - "*.test.*"
    - "*/tests/*"
    - "*/test/*"

# 重要性评分配置
importance_scoring:
  # 权重配置
  weights:
    complexity: 0.25        # 复杂度权重
    issue_density: 0.30     # 问题密度权重
    dependency: 0.20        # 依赖关系权重
    change_frequency: 0.15  # 变更频率权重
    business_logic: 0.10    # 业务逻辑权重
  # 复杂度阈值
  complexity_thresholds:
    simple: 5
    medium: 15
    high: 30
  # 问题密度阈值
  issue_density_thresholds:
    low: 1     # 每100行1个问题
    medium: 3  # 每100行3个问题
    high: 5    # 每100行5个问题

# 静态分析配置
static_analysis:
  # 启用的工具
  enabled_tools:
    - "ast_analyzer"
    - "pylint"
    - "flake8"
    - "bandit"
  # 工具配置
  tool_configs:
    pylint:
      enabled: true
      confidence_level: "high"
      output_format: "json"
    flake8:
      enabled: true
      max_line_length: 88
      extend_ignore: ["E203", "W503"]
    bandit:
      enabled: true
      confidence_level: "medium"
      severity_level: "medium"
    ast_analyzer:
      enabled: true
      extract_functions: true
      extract_classes: true
      extract_imports: true
  # 问题过滤
  filters:
    min_severity: "info"
    min_confidence: "low"
    max_issues_per_file: 100

# AI分析配置
ai_analysis:
  # LLM配置
  provider: "zhipu"  # zhipu, openai, anthropic
  model: "glm-4.5-air"
  temperature: 0.3
  max_tokens: 4000
  # 上下文配置
  context_priority: "balanced"  # minimal, balanced, comprehensive
  include_related_files: true
  max_related_files: 3
  context_lines: 5
  # 分析深度
  analysis_depth: "standard"  # shallow, standard, deep
  focus_areas:
    - "security"
    - "performance"
    - "maintainability"
    - "best_practices"

# 修复建议配置
fix_generation:
  # 策略配置
  default_strategy: "suggestion_only"  # automatic, interactive, suggestion_only, manual
  # 风险阈值
  risk_thresholds:
    automatic_risk: "low"
    interactive_risk: "medium"
  # 置信度阈值
  confidence_threshold: 0.7
  # 影响分析
  analyze_impact: true
  check_breaking_changes: true
  # 生成选项
  generate_alternatives: true
  max_alternatives: 3
  include_tests: true

# 报告配置
reporting:
  # 输出格式
  formats:
    - "json"
    - "html"
    - "markdown"
  # 报告内容
  include_sections:
    - "summary"
    - "issues"
    - "fixes"
    - "statistics"
    - "recommendations"
  # 详细程度
  detail_level: "standard"  # minimal, standard, detailed
  # 可视化
  generate_charts: true
  include_code_snippets: true

# 缓存配置
cache:
  # 启用缓存
  enabled: true
  # 缓存位置
  cache_dir: ".cache/project_analysis"
  # 缓存策略
  ttl: 86400  # 24小时
  max_size: 104857600  # 100MB
  # 缓存内容
  cache_analysis_results: true
  cache_ai_responses: true
  cache_importance_scores: true

# 性能配置
performance:
  # 内存限制（MB）
  max_memory_mb: 2048
  # 进程限制
  max_processes: 4
  # 批处理配置
  batch_size: 10
  # 并发控制
  rate_limit: 10  # 每秒请求数

# 成本控制
cost_control:
  # Token限制
  daily_token_limit: 100000
  monthly_token_limit: 1000000
  # 预算限制（美元）
  daily_budget_limit: 10.0
  monthly_budget_limit: 100.0
  # 成本跟踪
  track_costs: true
  cost_alerts: true

# 安全配置
security:
  # 敏感信息过滤
  filter_secrets: true
  secret_patterns:
    - "password"
    - "api_key"
    - "token"
    - "secret"
    - "credential"
  # 代码执行安全
  allow_code_execution: false
  sandbox_mode: true

# 集成配置
integrations:
  # Git集成
  git:
    enabled: true
    analyze_history: true
    max_commits: 100
  # CI/CD集成
  cicd:
    enabled: false
    pipeline_format: "github_actions"
  # 通知配置
  notifications:
    enabled: false
    channels: []
    webhook_url: ""

# 日志配置
logging:
  # 日志级别
  level: "INFO"
  # 日志格式
  format: "structured"  # simple, structured, json
  # 日志输出
  outputs:
    - "file"
    - "console"
  # 日志文件
  log_file: "logs/project_analysis.log"
  max_file_size: "10MB"
  max_files: 5
  # 调试选项
  debug_mode: false
  verbose_output: false

# 环境配置
environment:
  # 工作目录
  work_dir: "./workspace"
  # 临时目录
  temp_dir: "./temp"
  # 备份目录
  backup_dir: "./backups"
  # 输出目录
  output_dir: "./output"

# 高级配置
advanced:
  # 实验性功能
  experimental_features:
    enable_ml_scoring: false
    enable_context_compression: false
    enable_parallel_analysis: true
  # 插件系统
  plugins:
    enabled: false
    plugin_dirs:
      - "./plugins"
  # 自定义规则
  custom_rules:
    enabled: false
    rules_dir: "./rules"